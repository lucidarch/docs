<!doctype html><html>
<head>
<title>
Validation :: Lucid
</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name=revised content="2021-09-29T15:39:53 UTC">
<meta name=description content>
<title>Validation :: Lucid</title>
<link rel="shortcut icon" href=/images/favicon.png type=image/x-icon>
<link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css integrity=sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css>
<script src=https://code.jquery.com/jquery-3.5.1.min.js></script>
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel=stylesheet>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/layout.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/css/style.main.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/css/style.menu.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/notice.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/tabs.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/panel.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/columns.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/children.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/attachments.css>
<link rel=stylesheet type=text/css href=https://docs.lucidarch.dev/sass/shortcodes/alert.css>
<link rel=stylesheet type=text/css href=/css/docport.css>
<script src=/js/docport.js></script>
<script type=text/javascript>var baseurl="https://docs.lucidarch.dev"</script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-96232175-1','auto'),ga('send','pageview'))</script><link rel=stylesheet href=/css/custom.css>
<link rel=stylesheet href=/css/syntax.css>
<link rel=apple-touch-icon sizes=180x180 href=/icon/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/icon/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/icon/favicon-16x16.png>
<link rel=manifest href=/icon/site.webmanifest>
<script async defer src=https://buttons.github.io/buttons.js></script>
</head>
<body data-url=/validation/ class=hideheader>
<style type=text/css>#debug{display:-webkit-box;display:-ms-flexbox;display:flex;line-height:3.5rem;margin-bottom:.35rem;padding:0 2rem;position:fixed;left:0;right:0;top:0;top:0;min-height:150px;background-color:#fff;border:3px solid red;z-index:10000;word-wrap:all;overflow:auto}</style>
<article>
<aside>
<div class=search>
<div class=searchbox>
<input data-search-input id=search-by type=text placeholder="Type to search...">
</div>
<script type=text/javascript src=/vendor/lunr/lunr.min.js></script>
<script type=text/javascript src=/vendor/auto-complete/auto-complete.js></script>
<link href=/vendor/auto-complete/auto-complete.css rel=stylesheet>
<script type=text/javascript>var baseurl="https://docs.lucidarch.dev"</script>
<script type=text/javascript src=/js/search.js></script>
</div>
<div style=margin-top:30px>
<a href=/concept style=display:flex;justify-content:left;align-items:center>
<img src=/icon/logo.png width=250 style=margin-left:10px>
</a>
</div>
<div id=close_menu>
<a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')">
<i class="fa fa-lg fa-times"></i>
</a>
</div>
<ul class=menu>
<li data-nav-id=https://docs.lucidarch.dev/concept/ class="dd-item
item_level_$level">
<a href=/concept/>Concept</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/philosophy/ class="dd-item
item_level_$level">
<a href=/philosophy/>Philosophy</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/principles/ class="dd-item
item_level_$level">
<a href=/principles/>Principles</a>
</li>
<hr>
<li data-nav-id=https://docs.lucidarch.dev/installation/ class="dd-item
item_level_$level">
<a href=/installation/>Installation</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/upgrade-guide/ class="dd-item alwaysopen
item_level_$level">
<a href=/upgrade-guide/>Upgrade Guide</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/contribution-guide/ class="dd-item
item_level_$level">
<a href=/contribution-guide/>Contribution Guide</a>
</li>
<hr>
<li data-nav-id=https://docs.lucidarch.dev/getting-started/ class="dd-item alwaysopen
item_level_$level">
<a href=/getting-started/>Getting Started</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/micro-vs-monolith/ class="dd-item
item_level_$level">
<a href=/micro-vs-monolith/>Micro • Monolith</a>
</li>
<hr>
<li data-nav-id=https://docs.lucidarch.dev/routing/ class="dd-item
item_level_$level">
<a href=/routing/>Routing</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/controllers/ class="dd-item
item_level_$level">
<a href=/controllers/>Controllers</a>
</li>
<hr>
<li data-nav-id=https://docs.lucidarch.dev/features/ class="dd-item
item_level_$level">
<a href=/features/>Features</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/jobs/ class="dd-item
item_level_$level">
<a href=/jobs/>Jobs</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/operations/ class="dd-item
item_level_$level">
<a href=/operations/>Operations</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/services/ class="dd-item
item_level_$level">
<a href=/services/>Services</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/domains/ class="dd-item
item_level_$level">
<a href=/domains/>Domains</a>
</li>
<hr>
<li data-nav-id=https://docs.lucidarch.dev/database/ class="dd-item
item_level_$level">
<a href=/database/>Database</a>
</li>
<li data-nav-id=https://docs.lucidarch.dev/validation/ class="dd-item parent active
item_level_$level">
<a href=/validation/>Validation</a>
</li>
<hr>
<li data-nav-id=https://docs.lucidarch.dev/cli/ class="dd-item
item_level_$level">
<a href=/cli/>CLI Reference</a>
</li>
</ul>
</aside>
<section class=page>
<nav id=ariane aria-label=breadcrumb>
<ol class=ariane>
<li>
<a class=text-link href=https://docs.lucidarch.dev>
Home
</a>
</li>
<li class=active>
Validation
</li>
</ol>
</nav>
<h1>Validation</h1>
<div class=jump-to-section>
<span onclick="$h=$(this),$h.next('nav').slideToggle(100,function(){$h.children('i').attr('class',function(){return $h.next('nav').is(':visible')?'fas fa-chevron-down':'fas fa-chevron-right'})})">
<span class="fas fa-align-right"></span>
Jump to Section
<i class="fas fa-chevron-right"></i>
</span>
<nav id=TableOfContents>
<ul>
<li><a href=#domain-driven-validation>Domain-Driven Validation</a></li>
<li><a href=#form-request-validation>Form Request Validation</a>
<ul>
<li><a href=#generate-form-request>Generate Form Request</a></li>
<li><a href=#requests-as-unit-dispatchers>Requests as Unit Dispatchers</a></li>
</ul>
</li>
<li><a href=#validation-jobs>Validation Jobs</a></li>
</ul>
</nav>
</div>
<div class=content>
<p>As common as it is, validation is essential for every application.
Lucid brings a domain-driven approach that embraces Laravel&rsquo;s validation. In short, if you&rsquo;ve done validation with Laravel
you&rsquo;re already familiar with everything here, we will only choose convenient locations for Validators and Form Requests
by placing them in domains.</p>
<h2 ref=domain-driven-validation>Domain-Driven Validation</h2><a class=anchor id=domain-driven-validation></a>
<p>Often times validation is a matter of context, and domains in Lucid are an ideal place to encapsulate functionality,
and form requests fit perfectly there! e.g. <code>Domains/{domain}/Requests/{Request}.php</code></p>
<p>Eventually we&rsquo;d end up with a categorical directory structure that protects our validation files from becoming unmanageable.</p>
<div class=columns>
<div class=column>
<p><strong>Form Requests</strong></p>
<pre tabindex=0><code>app/Domains
├── Chat
│   └── Requests
│       └── SendMessage.php
├── Comment
│   └── Requests
│       └── AddComment.php
├── Filesystem
│   └── Requests
│       └── UploadFiles.php
└── Post
    └── Requests
        ├── CreatePost.php
        └── UpdatePost.php
</code></pre>
</div>
<div class=column>
<p><strong>Validation Jobs</strong></p>
<pre tabindex=0><code>app/Domains
├── Chat
│   └── Jobs
│       └── ValidateNewMessageJob.php
├── Comment
│   └── Jobs
│       └── ValidateNewCommentJob.php
├── Filesystem
│   └── Jobs
│       └── ValidateFilesUploadJob.php
└── Post
    └── Jobs
        ├── ValidateNewPostJob.php
        └── ValidatePostUpdateJob.php
</code></pre>
</div>
</div>
<h2 ref=form-request-validation>Form Request Validation</h2><a class=anchor id=form-request-validation></a>
<p>In an effort to keep our controllers thin and reduce their clutter, as well as having features carry their requirements with
them wherever we decide to serve them from, it is recommended for <strong>validation using Form Request to happen in features instead of controllers</strong>, to maintain their integrity whenever they&rsquo;re served.</p>
<p>Nevertheless, it is done exactly the same as Laravel controllers in any of Lucid&rsquo;s units,
by injecting the form request class in the method signature as a parameter:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=k>class</span> <span class=nc>CustomFeature</span> <span class=k>extends</span> <span class=nx>Feature</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>UpdatePost</span> <span class=nv>$request</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=c1>// request is valid according to the rules specified in UpdatePost
</span><span class=c1></span>    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>This will perform Form Request Validation using <code>UpdatePost</code> class.</p>
<div class="notices info">
<p><i class="fas fa-info-circle"></i> The same can be done in any unit: Feature, Job and Operation.</p>
</div>
<div class="notices dark">
<p>For more on Form Request classes see <a href=https://laravel.com/docs/validation#form-request-validation>Laravel&rsquo;s docs</a>.</p>
</div>
<h3 ref=generate-form-request>Generate Form Request</h3><a class=anchor id=generate-form-request></a>
<div class=tabs><input type=radio name=tabs-3 id=tabs-3-0 checked>
<label for=tabs-3-0>Micro</label>
<div class=tab><p><strong>Signature</strong></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>lucid make:request &lt;name&gt; &lt;domain&gt;
</code></pre></div><p><strong>Example</strong></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>lucid make:request UpdatePost post
</code></pre></div><p>Generated class will be at <code>app/Domains/Post/Requests/UpdatePost.php</code></p>
</div><input type=radio name=tabs-3 id=tabs-3-1>
<label for=tabs-3-1>Monolith</label>
<div class=tab><p><strong>Signature</strong></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>lucid make:request &lt;name&gt; &lt;domain&gt;
</code></pre></div><p><strong>Example</strong></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>lucid make:request UpdatePost post
</code></pre></div><p>Generated class will be at <code>src/Domains/Post/Requests/UpdatePost.php</code></p>
</div></div>
<p><br></p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>

<span class=k>namespace</span> <span class=nx>App\Domains\Post\Requests</span><span class=p>;</span>

<span class=k>use</span> <span class=nx>Illuminate\Foundation\Http\FormRequest</span><span class=p>;</span>

<span class=k>class</span> <span class=nc>UpdatePost</span> <span class=k>extends</span> <span class=nx>FormRequest</span>
<span class=p>{</span>
    <span class=sd>/**
</span><span class=sd>     * Determine if the user is authorized to make this request.
</span><span class=sd>     *
</span><span class=sd>     * @return bool
</span><span class=sd>     */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>authorize</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=k>true</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=sd>/**
</span><span class=sd>     * Get the validation rules that apply to the request.
</span><span class=sd>     *
</span><span class=sd>     * @return array
</span><span class=sd>     */</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>rules</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=p>[</span>
            <span class=c1>//
</span><span class=c1></span>        <span class=p>];</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h3 ref=requests-as-unit-dispatchers>Requests as Unit Dispatchers</h3><a class=anchor id=requests-as-unit-dispatchers></a>
<p>One of the most powerful aspects of Lucid is the degree of code reuse it introduces. Specifically when dealing with
Job and Operation classes which can be called from any <a href=https://docs.lucidarch.dev/jobs/#custom-dispatcher>custom dispatcher class</a>.</p>
<p>Here, we will be setting up <code>UpdatePost</code> Request class to authorize using <code>AuthorizeUserOperation</code>, and on <a href=https://laravel.com/docs/8.x/validation#adding-after-hooks-to-form-requests>after hook</a>
to run <code>FaliedValidationJob</code>.</p>
<div class=card><div class=card-body>
<p class=card-text><p><strong>Benefit:</strong> Doing so would increase the degree of consistency and integrity in our application,
where <code>AuthorizeUserOperation</code> could contain our consolidated authorization mechanism and
can be called from any other class such as middleware to authoriza pre-flight.
As for <code>FaliedValidationJob</code> it will ensure that all of our failed validations are handled consistently as expected.</p>
</p>
</div></div>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>

<span class=k>namespace</span> <span class=nx>App\Domains\Post\Requests</span><span class=p>;</span>

<span class=k>use</span> <span class=nx>Lucid\Bus\UnitDispatcher</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Operations\AuthorizeUserOperation</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Foundation\Http\FormRequest</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>App\Domains\Http\Jobs\FailedValidationJob</span><span class=p>;</span>

<span class=k>class</span> <span class=nc>UpdatePost</span> <span class=k>extends</span> <span class=nx>FormRequest</span>
<span class=p>{</span>
    <span class=k>use</span> <span class=nx>UnitDispatcher</span><span class=p>;</span>

    <span class=k>public</span> <span class=k>function</span> <span class=nf>authorize</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=nx>AuthorizeUserOperation</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>function</span> <span class=nf>rules</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=p>[</span>
            <span class=s1>&#39;title&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;required|unique:posts|max:255&#39;</span><span class=p>,</span>
            <span class=s1>&#39;body&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;required&#39;</span><span class=p>,</span>
        <span class=p>];</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>function</span> <span class=nf>withValidator</span><span class=p>(</span><span class=nv>$validator</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=nv>$validator</span><span class=o>-&gt;</span><span class=na>after</span><span class=p>(</span><span class=k>function</span> <span class=p>(</span><span class=nv>$validator</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>somethingElseIsInvalid</span><span class=p>())</span> <span class=p>{</span>
                <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>run</span><span class=p>(</span><span class=k>new</span> <span class=nx>FailedValidationJob</span><span class=p>(</span><span class=nv>$validator</span><span class=p>));</span>
            <span class=p>}</span>
        <span class=p>});</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h2 ref=validation-jobs>Validation Jobs</h2><a class=anchor id=validation-jobs></a>
<p>Another approach to validation is to validate using jobs. This is most useful with protocols other than HTTP (e.g. Console, AMQP, etc.),
or if you simply choose not to use Requests.</p>
<p>Our validation jobs would contain <a href=https://laravel.com/docs/8.x/validation#quick-writing-the-validation-logic>validation logic</a>
so it can be called whenever validation is required.</p>
<p>Start by creating a job:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>lucid make:job ValidatePostUpdate post
</code></pre></div><p>Then inject <code>Illuminate\Http\Request</code> and fill in your validation logic:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>

<span class=k>namespace</span> <span class=nx>App\Domains\Post\Jobs</span><span class=p>;</span>

<span class=k>use</span> <span class=nx>Lucid\Units\Job</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Http\Request</span><span class=p>;</span>

<span class=k>class</span> <span class=nc>ValidatePostUpdateJob</span> <span class=k>extends</span> <span class=nx>Job</span>
<span class=p>{</span>
    <span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>Request</span> <span class=nv>$request</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=nv>$validData</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>validate</span><span class=p>([</span>
            <span class=s1>&#39;title&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;required|unique:posts|max:255&#39;</span><span class=p>,</span>
            <span class=s1>&#39;body&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;required&#39;</span><span class=p>,</span>
        <span class=p>]);</span>

        <span class=k>return</span> <span class=nv>$validData</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div>
</div>
<div class=chevrons>
<a class=next href=/cli/ title="CLI Reference" style=margin-right:0>
<div>
<p>Next page</p>
<label>CLI Reference</label>
</div>
<i class="fas fa-arrow-right" style=font-size:1.7em></i></a>
</div>
</section>
<section class=right-menu>
<div class=TableOfContents>
<label><i class="fas fa-align-right"></i>&nbsp;&nbsp;What's on this page</label>
<nav>
<ul>
<li><a href=/validation/>Validation</a></li>
</ul>
</nav>
<nav id=TableOfContents>
<ul>
<li><a href=#domain-driven-validation>Domain-Driven Validation</a></li>
<li><a href=#form-request-validation>Form Request Validation</a>
<ul>
<li><a href=#generate-form-request>Generate Form Request</a></li>
<li><a href=#requests-as-unit-dispatchers>Requests as Unit Dispatchers</a></li>
</ul>
</li>
<li><a href=#validation-jobs>Validation Jobs</a></li>
</ul>
</nav>
</div>
<div class=Actions>
<nav>
<ul>
<li>
<i class="fas fa-calendar"></i>
Last update on 29 September 2021
</li>
<li title>
<i class="fas fa-user"></i>
Last update by Abed Halawi
</li>
</ul>
</nav>
</div>
</section>
</article>
<footer>
<div class=columns>
<div class=column>
<div style=font-family:Raleway!important>
<h3 style=color:#fdfdfd!important>lucid architecture</h3>
for a scalable future software
</div>
</div>
<div class=column>
<div style=display:flex;justify-content:flex-end;align-items:center>
<div style=align-items:center;display:flex>
<a href=https://lucidarch.dev target=_blank><img src=/icon/lucid-coloured.png alt="Lucid website link" width=28px style=margin-top:4px></a>
<a href=https://github.com/lucidarch target=_blank style=margin-left:10px><i class="fab fa-github fa-lg"></i></a>
<a href=https://lucid-slack.herokuapp.com target=_blank style=margin-left:10px><i class="fab fa-slack fa-lg"></i></a>
<a href=https://www.reddit.com/r/lucidarch target=_blank style=margin-left:10px><i class="fab fa-reddit-alien fa-lg"></i></a>
</div>
<div style=margin-left:50px;margin-top:6px>
<a class=github-button href=https://github.com/sponsors/lucidarch data-icon=octicon-heart aria-label="Sponsor @lucidarch on GitHub">Sponsor</a>
<a class=github-button href=https://github.com/lucidarch/lucid data-icon=octicon-star data-show-count=true aria-label="Star lucidarch/lucid on GitHub">Star</a>
</div>
</div>
</div>
</div>
</footer>
</body>
</html>